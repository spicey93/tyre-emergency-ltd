---
// src/pages/get-quote.astro (REFACTORED)
import BaseLayout from "../layouts/BaseLayout.astro";
import ElfsightWidget from "../components/ElfsightWidget.astro";
import ContactInfo from "../components/ContactInfo.astro";
import MainContent from "../components/MainContent.astro";
import { company, pages } from "../data/config.json";
import { groupOpeningHours } from "../utils/openingHours";
import { formatAddress } from "../utils/format";

const { phone, email, address, openingHours } = company;
const pageTitle = "Get Quote";

const groupedHours = groupOpeningHours(openingHours);
const formattedAddress = formatAddress(address, { separator: ", " });

// Get services from config
const servicesConfig = pages.services[0];
const availableServices = Object.entries(servicesConfig)
  .filter(([_, service]) => service.isProvided)
  .map(([key, service]) => ({
    value: key,
    label: service.pageTitle
  }));
---

<BaseLayout pageTitle={pageTitle}>
  <MainContent
    mainHeading={pageTitle}
    mainContent={[
      "If you have any questions, or would like a price for our sevices, get in touch today.",
    ]}
  />
  <div class="container mt-5 mb-5">
    <div class="row g-5">
      <div class="col-lg-6 order-lg-2">
        <p class="mb-4 h5 text-dark">Request Your Quote</p>
        <form
          name="contact"
          method="POST"
          data-netlify="true"
          class="quote-form"
            data-netlify-recaptcha="true"
        >
          <input type="hidden" name="form-name" value="contact" />

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="name" class="form-label"
                >Full Name <span class="text-danger">*</span></label
              >
              <input
                type="text"
                id="name"
                name="name"
                class="form-control"
                placeholder="John Smith"
                required
              />
            </div>

            <div class="col-md-6 mb-3">
              <label for="email" class="form-label"
                >Email Address <span class="text-danger">*</span></label
              >
              <input
                type="email"
                id="email"
                name="email"
                class="form-control"
                placeholder="john@example.com"
                required
              />
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="phone" class="form-label"
                >Phone Number <span class="text-danger">*</span></label
              >
              <input
                type="tel"
                id="phone"
                name="phone"
                class="form-control"
                placeholder="07XXX XXXXXX"
                required
              />
            </div>

            <div class="col-md-6 mb-3">
              <label for="postcode" class="form-label"
                >Postcode <span class="text-danger">*</span></label
              >
              <input
                type="text"
                id="postcode"
                name="postcode"
                class="form-control"
                placeholder="e.g. SW1A 1AA"
                style="text-transform: uppercase;"
                required
              />
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="registration" class="form-label"
                >Vehicle Registration</label
              >
              <input
                type="text"
                id="registration"
                name="registration"
                class="form-control"
                placeholder="e.g. AB12 CDE"
                style="text-transform: uppercase;"
              />
            </div>
            <div class="mb-3 col-md-6">
              <label for="service" class="form-label"
                >Service Required <span class="text-danger">*</span></label
              >
              <select id="service" name="service" class="form-select" required>
                <option value="">-- Select a service --</option>
                {availableServices.map((service) => (
                  <option value={service.value}>{service.label}</option>
                ))}
                <option value="general-enquiry">General Enquiry</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>

          
          <div class="mb-4">
            <label for="message" class="form-label">Additional Details</label>
            <textarea
              id="message"
              name="message"
              class="form-control"
              rows="5"
              placeholder="Please provide any additional information about your requirements..."
            ></textarea>
          </div>

          <div data-netlify-recaptcha="true"></div>

          <button type="submit" class="btn btn-primary text-light">
            <i class="bi bi-send-fill me-2"></i>Get Quote
          </button>

          <p class="text-muted small mt-3 mb-0">
            <i class="bi bi-shield-check me-1"></i>
            We respect your privacy and will never share your information.
          </p>
        </form>
      </div>
      <div class="col-lg-6 order-lg-1">
        <ContactInfo icon="telephone-fill" title="Phone" text={phone} />
        <ContactInfo icon="envelope-fill" title="Email" text={email} />
        <ContactInfo icon="map-fill" title="Find Us" text={formattedAddress} />
        <ContactInfo icon="clock-fill" title="Opening Hours">
          {
            groupedHours.map((group) => (
              <div
                class={`row text-muted ${group.isClosed ? "closed" : "open"}`}
              >
                <div class="col-6">
                  {group.days.length === 1
                    ? group.days[0]
                    : group.days.length === 2
                      ? group.days.join(" & ")
                      : `${group.days[0]} - ${group.days[group.days.length - 1]}`}
                </div>
                <div class="col-6">
                  {group.isClosed
                    ? "Closed"
                    : `${group.opens} - ${group.closes}`}
                </div>
              </div>
            ))
          }
        </ContactInfo>
      </div>
    </div>
  </div>
</BaseLayout>
