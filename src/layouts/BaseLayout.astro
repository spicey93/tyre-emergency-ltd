---
// src/layouts/BaseLayout.astro (REFACTORED)
import "../styles/main.css";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { company, social, google } from "../data/config.json";
import TyreBrands from "../components/TyreBrands.astro";
import CTABar from "../components/CTABar.astro";
import CookieConsent from "../components/CookieConsent.astro";
import { generateLocalBusinessSchema } from "../utils/schema";

const { pageTitle, description } = Astro.props;
const schema = generateLocalBusinessSchema(company, social);
const hasGTM = google?.tagManagerId && google.tagManagerId !== "";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <link rel="shortcut icon" href="/public/favicon.ico" type="image/x-icon">
    <title>{pageTitle} | {company.name}</title>
    <meta name="description" content={description} />

    <!-- Schema Mark Up - Local Business -->
    <script type="application/ld+json" set:html={JSON.stringify(schema)} />
    
    {hasGTM && (
        <!-- Google Tag Manager Consent Mode (loads before GTM) -->
        <script is:inline>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('consent', 'default', {
            'analytics_storage': 'denied',
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'wait_for_update': 500
          });
        </script>
    )}
  </head>
  <body class="vh-100 d-flex flex-column">
    {hasGTM && (
      <!-- Google Tag Manager (noscript) -->
      <noscript>
        <iframe src={`https://www.googletagmanager.com/ns.html?id=${google.tagManagerId}`}
          height="0" width="0" style="display:none;visibility:hidden"></iframe>
      </noscript>
    )}
    <Header />
    <slot style="flex: 1" />
    <TyreBrands />
    <CTABar />
    <Footer />
    <CookieConsent />
    <script src="../scripts/bootstrap.min.js"></script>
    <script src='https://elfsightcdn.com/platform.js' async></script>
  </body>
</html>